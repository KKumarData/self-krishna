import os
from pyspark.sql import SparkSession, types

class CSVReader:

    def __init__(self):
        self.spark = SparkSession.builder.appName("CSV Reader").getOrCreate()

    def read_csv(self, file_path, schema=None, header=True, infer_schema=True, sep=",", null_value=None, timestamp_format=None):
        """Read a CSV file and return a Spark DataFrame.

        Parameters:
        - file_path: string, path to the CSV file
        - schema: string, JSON representation of the schema to use for the DataFrame (default is None)
        - header: boolean, whether the CSV file has a header or not (default is True)
        - infer_schema: boolean, whether to infer the data types of the columns (default is True)
        - sep: string, the field delimiter (default is ',')
        - null_value: string, the string representation of a null value (default is None)
        - timestamp_format: string, the format of the timestamp columns (default is None)
        """
        try:
            # Check if the file exists
            if not os.path.exists(file_path):
                raise FileNotFoundError(f"File not found at {file_path}")

            if schema:
                # Convert the JSON schema string to a StructType
                struct_type = types.StructType.fromJson(schema)
                df = self.spark.read.csv(file_path, schema=struct_type, header=header, sep=sep, nullValue=null_value, timestampFormat=timestamp_format)
            else:
                df = self.spark.read.csv(file_path, header=header, inferSchema=infer_schema, sep=sep, nullValue=null_value, timestampFormat=timestamp_format)
            return df
        except Exception as e:
            print(f"Error occurred while reading CSV file: {e}")
            return None


def main():
	schema = """{
		"type": "struct",
		"fields": [
			{"name": "id", "type": "integer", "nullable": false},
			{"name": "name", "type": "string", "nullable": false},
			{"name": "age", "type": "integer", "nullable": false}
		]
	}"""

	csv_reader = CSVReader()
	df = csv_reader.read_csv("path/to/file.csv", schema=schema, header=True, sep=",")
	
if __name__ == "__main__":
	main()
	
	